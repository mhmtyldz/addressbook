@model List<ContactListViewModel>
@{
    ViewData["Title"] = "List";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/assets/css/table.css" rel="stylesheet" />
<style>
    .dt-buttons {
        display: none !important;
    }

    a:not([href]):not([tabindex]) {
        color: white;
    }

    #excelExport:hover {
        color: white;
    }

    .dataTables_scrollBody {
        margin: -27px 0 0 0;
    }

    .main-content {
        padding: 5px 5px 0 !important
    }

    .pagination {
        float: right
    }
</style>
<div class="main-content">
    <div class="card">
        <div class="card-body">

            <table class="table table-striped table-bordered dataTable no-footer" id="example" cellspacing="0" @*data-provide="datatables"*@>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Surname</th>
                        <th>Email Address</th>
                        <th>Phone Number</th>
                        <th>Location </th>
                        <th>Update </th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null)
                    {
                        foreach (var contact in Model)
                        {
                            <tr>
                                <td>@contact.Name</td>
                                <td>@contact.Lastname</td>
                                <td>@contact.EmailAddress</td>
                                <td>@contact.PhoneNumber</td>
                                <td>@contact.Location</td>
                                <td><button onclick="getDetail('@contact.Id')" class="btn btn-primary btn-xs">Update</button></td>
                                <td><button onclick="deleteContact('@contact.Id')" class="btn btn-danger btn-xs">Delete</button></td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Detail</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" class="form-control" id="Id" value="" />
                <div id="detail-summary">
                    <div class="form-group col-md-12">
                        <label>Name</label>
                        <input type="text" class="form-control" id="Name" value="" />
                    </div>
                    <div class="form-group col-md-12">
                        <label>LastName</label>
                        <input type="text" class="form-control" id="Lastname" value="" />
                    </div>
                    <div class="form-group col-md-12">
                        <button class="btn btn-success  pull-right" id="contactSave">Update</button>
                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-xs" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
@section Scripts{
    <script>
        function deleteContact(id) {
            $.ajax({
                url: '/Contact/DeleteContact?id=' + id,
                type: 'GET',
                success: function (data) {
                    if (data) {
                        Swal.fire(
                            'Successfull!',
                            'Contact was deleted.',
                            'success'
                        )
                        location.reload();
                    }
                    else {
                        Swal.fire(
                            'Hata!',
                            'Bu summary bulunamadı.',
                            'error'
                        )
                    }

                },
                error: function (hata) {
                    Swal.fire(
                        'Hata!',
                        'Genel hata.Lütfen admine başvurunuz',
                        'error'
                    )
                }
            });

        }
        function getDetail(id) {
            $('#exampleModalCenter').modal('show');
            $.ajax({
                url: '/Contact/GetDetail?id=' + id,
                type: 'GET',
                success: function (data) {
                    if (data != null) {
                        $('#Id').val(data.uuid);
                        $('#Name').val(data.name);
                        $('#Lastname').val(data.lastName);
                    }
                    else {
                        Swal.fire(
                            'Hata!',
                            'Bu summary bulunamadı.',
                            'error'
                        )
                    }

                },
                error: function (hata) {
                    Swal.fire(
                        'Hata!',
                        'Genel hata.Lütfen admine başvurunuz',
                        'error'
                    )
                }
            });

        }

        $('#contactSave').on('click', function () {
            var name = $('#Name').val();
            var lastName = $('#Lastname').val();
            var id = $('#Id').val();
            $.ajax({
                url: '/Contact/UpdateContact',
                type: 'POST',
                data: { id: id, name: name, lastName: lastName },
                success: function (data) {
                    if (data) {
                        Swal.fire(
                            'Success!',
                            'Data was updated.',
                            'success'
                        )
                    }
                    else {
                        Swal.fire(
                            'Error!',
                            'Güncelleme işlemi gerçekleşmedi.',
                            'error'
                        )
                    }

                },
                error: function (hata) {
                    Swal.fire(
                        'Hata!',
                        'Genel hata.Lütfen admine başvurunuz',
                        'error'
                    )
                }
            });
        })
    </script>
} 